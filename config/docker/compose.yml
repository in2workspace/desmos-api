services:

  scorpio:
    image: scorpiobroker/all-in-one-runner:java-latest
    environment:
      DBHOST: postgis
    ports:
      - "9090:9090"
    links:
      - postgis

  postgis:
    image: postgis/postgis
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: ngb
      POSTGRES_PASSWORD: ngb
      POSTGRES_DB: ngb
#    volumes:
#      - postgis:/var/lib/postgresql/data

  desmos:
    image: desmos:latest
    environment:
      SPRING_R2DBC_URL: r2dbc:postgresql://postgres:5432/dbtest
      SPRING_R2DBC_USERNAME: postgres
      SPRING_R2DBC_PASSWORD: postgres
      SPRING_FLYWAY_URL: jdbc:postgresql://postgres:5432/dbtest
      LOGGING_LEVEL_ES_IN2_DESMOS: DEBUG
      CLIENT_ORGANIZATIONID: VATES-S9999999E
      DLT_ADAPTER_PROVIDER: digitelts
      DLT_ADAPTER_INTERNAL_DOMAIN: http://dlt-adapter:8080
      DLT_ADAPTER_EXTERNAL_DOMAIN: http://dlt-adapter:8080
      TX_SUBSCRIPTION_NOTIFICATION_ENDPOINT: http://desmos:8080/api/v1/notifications/dlt
      TX_SUBSCRIPTION_ENTITY_TYPES: ProductOffering,Category,Catalogue
      BROKER_PROVIDER: scorpio
      BROKER_EXTERNAL_DOMAIN: http://scorpio:9090
      BROKER_INTERNAL_DOMAIN: http://scorpio:9090
      NGSI_SUBSCRIPTION_NOTIFICATION_ENDPOINT: http://desmos:8080/api/v1/notifications/broker
      NGSI_SUBSCRIPTION_ENTITY_TYPES: ProductOffering,Category,Catalogue
    ports:
      - "9091:8080"
    links:
      - dlt-adapter
      - scorpio
      - postgres

  postgres:
    image: postgres:16.1
    ports:
      - "5433:5432"
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: dbtest
#    volumes:
#      - postgres:/var/lib/postgresql/data

  dlt-adapter:
    image: quay.io/digitelts/dlt-adapter:1.3
    environment:
        PRIVATE_KEY: 0x304d170fb355df65cc17ef7934404fe9baee73a1244380076436dec6fafb1e1f
        DOME_EVENTS_CONTRACT_ADDRESS:
        RPC_ADDRESS: http://blockchain-testnode.infra.svc.cluster.local:8545/
        DOME_PRODUCTION_BLOCK_NUMBER: 0
        ISS: 0x9eb763b0a6b7e617d56b85f1df943f176018c8eedb2dd9dd37c0bd77496833fe
    ports:
      - "9092:8080"

#volumes:
#  postgis:
#  postgres:
